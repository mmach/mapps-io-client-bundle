var w=Object.defineProperty;var d=(a,i)=>w(a,"name",{value:i,configurable:!0});import{r as c,q as m,p as f,R as p,h as k,e as l,F as v}from"./index-3f4d4c10.js";function h(){const[a,i]=c.useState([]),[u,r]=c.useState(!1),{selectors:{iuaReducer:{iuaRelations:t,iuaSockets:_}},actions:{setProcessChainId:n=n}}=m({}),{selectors:{messagesReducer:{is_connected:e=e}}}=f();c.useEffect(()=>{const s=[];a.forEach(o=>{Object.keys(t).includes(o)?s.push(o):window.mapps_socket.emit("leave-iua",{iua_id:o})}),Object.keys(t).map(o=>{a.includes(o)||window.mapps_socket.emit("join-iua",{iua_id:o}),s.push(o)}),i(s)},[t]),c.useEffect(()=>(e&&u==!1&&(r(!0),window.mapps_socket.on("iua_status",function(s){}),window.mapps_socket.on("iua_process_chain",function(s){try{n(s.iua_id,s.process_chain_id)}catch(o){console.log(o)}}),window.mapps_socket.on("iua_joined",function(s){})),()=>{window.mapps_socket&&(window.mapps_socket.off("iua_joined"),window.mapps_socket.off("iua_process_chain"),window.mapps_socket.off("iua_status"))}),[e])}d(h,"iuaSocketsHook");const S=d(()=>{h();const[a,i]=p.useState(!1),[u]=p.useState([]),{selectors:{messagesReducer:{is_connected:r}},actions:t}=f(),{selectors:{authReducer:{user:_}}}=k();return c.useEffect(()=>{if(r==!0&&a==!1){i(!0);let n=_.id;window.mapps_socket.on("msg-saved",function(){}),window.mapps_socket.on("invite",function(e){window.mapps_socket.emit("join-room",{conversation_id:e.conversation_id}),u.find(s=>s==e.conversation_id)||window.mapps_socket.emit("join-room",{conversation_id:e.conversation_id}),e.conversation&&t.addConv({conversation:e.conversation})}),window.mapps_socket.onAny((e,...s)=>{console.log(e,s)}),window.mapps_socket.on("new_msg",function(e){t.newMessage({...e,currentUserId:n}),e.users.filter(o=>o.user_id==n).length>0&&t.unreadMessages([e])}),window.mapps_socket.on("msg_read",function(e){e.user_id==n?t.readMsg(e):t.setAsReadMsg(e)}),window.mapps_socket.on("message-room",function(e){t.newMessage({...e,currentUserId:n})})}},[r]),l(v,{})},"MessagesListner"),j=p.memo(S);export{j as default};
