var g=Object.defineProperty;var w=(n,a)=>g(n,"name",{value:a,configurable:!0});import{r as u,q as h,p as m,R as p,h as S,e as M,F as E}from"./index-06cc938e.js";function R(){const[n,a]=u.useState([]),[_,i]=u.useState(!1),{selectors:{iuaReducer:{iuaRelations:o,iuaSockets:f}},actions:{setProcessChainId:c=c}}=h({}),{selectors:{messagesReducer:{is_connected:r=r}}}=m();u.useEffect(()=>{const t=[];n.forEach(s=>{Object.keys(o).includes(s)?t.push(s):window.mapps_socket.emit("leave-iua",{iua_id:s})}),Object.keys(o).map(s=>{n.includes(s)||window.mapps_socket.emit("join-iua",{iua_id:s}),t.push(s)}),a(t)},[o]),u.useEffect(()=>(r&&_==!1&&(i(!0),window.mapps_socket.on("iua_status",function(t){}),window.mapps_socket.on("iua_process_chain",function(t){try{c(t.iua_id,t.process_chain_id)}catch(s){console.log(s)}}),window.mapps_socket.on("iua_joined",function(t){})),()=>{window.mapps_socket&&(window.mapps_socket.off("iua_joined"),window.mapps_socket.off("iua_process_chain"),window.mapps_socket.off("iua_status"))}),[r])}w(R,"iuaSocketsHook");const j=w(()=>{R();const[n,a]=p.useState(!1),[_]=p.useState([]),{selectors:{messagesReducer:{is_connected:i=i}},actions:o=o}=m(),{selectors:{authReducer:{user:f=f}}}=S();return p.useEffect(()=>{if(i==!0&&n==!1){a(!0);let c=o.newMessage,r=o.unreadMessages,t=o.readMsg,s=f.id,l=o.setAsReadMsg,k=o.addConv;window.mapps_socket.on("msg-saved",function(){}),window.mapps_socket.on("invite",function(e){window.mapps_socket.emit("join-room",{conversation_id:e.conversation_id}),_.find(d=>d==e.conversation_id)||window.mapps_socket.emit("join-room",{conversation_id:e.conversation_id}),e.conversation&&k({conversation:e.conversation})}),window.mapps_socket.onAny((e,...d)=>{console.log(e,d)}),window.mapps_socket.on("new_msg",function(e){c(e),e.users.filter(v=>v.user_id==s).length>0&&r([e])}),window.mapps_socket.on("msg_read",function(e){e.user_id==s?t(e):l(e)}),window.mapps_socket.on("message-room",function(e){c(e)})}},[i]),M(E,{})},"MessagesListner"),x=p.memo(j);export{x as default};
