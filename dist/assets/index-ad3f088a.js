import{L as K,N as $,a as x,O as R,bG as H,$ as X,i as J,a0 as ee,R as s,m as te,M as p,U as F,l as j,G as c,j as e,X as E,Y as V,a1 as ne,a2 as se,a3 as O,W as G,V as Q,Z as W}from"./index-1a5b9518.js";import{d as re}from"./Extension-feb01109.js";import{d as oe}from"./Close-08bde041.js";import{S as ae}from"./style-c6e25026.js";import{d as ie}from"./LockOpen-c2802198.js";import{I as z}from"./IconButton-dbe13826.js";import"./createSvgIcon-51564d9c.js";const ue=({type:t})=>({columns:[{titleToken:"CREATED AT",field:"createdAt",type:"date",isActive:!0},{titleToken:"TOKEN",field:"token",isActive:!0},{titleToken:"IS LAZY",field:"load_on_init",isActive:!0,type:"!checkbox"},{titleToken:"ACTIVE",field:"is_active",isActive:!0,type:"checkbox"}],enableMultiRowSelection:!1,enableRowSelection:!0}),S=t=>{const r={getCmsMenuAdmin:()=>t(new R().queryThunt("getCmsMenusAdminQuery",{})),getProjectCmsMenuElement:()=>t(new R().queryThunt("getCmsMenusQuery",{})),setCurrentMenuId:n=>t({type:H.SET_CURRENT_MENU,dto:n}),clean:n=>t({type:H.CLEAN_MENU_STORAGE}),upsertProjectCmsMenu:n=>t(new R().commandThunt("upsertProjectCmsMenuCommand",n)),deleteProjectCmsMenuItem:n=>t(new R().commandThunt("deleteProjectCmsMenuItemCommand",n)),upsertCmsMenuItem:n=>t(new R().commandThunt("upsertProjectCmsMenuItemCommand",n)),upsertProjectCmsMenuItemPrivilegeCommand:n=>t(new R().commandThunt("upsertProjectCmsMenuItemPrivilegeCommand",n)),deleteProjectCmsMenuItemPrivilegeCommand:n=>t(new R().commandThunt("deleteProjectCmsMenuItemPrivilegeCommand",n)),deleteProjectCmsMenu:n=>t(new R().commandThunt("deleteProjectCmsMenuCommand",n))};return{...r,upsertCmsMenuItem:async n=>{await r.upsertCmsMenuItem(n),await r.getCmsMenuAdmin()},upsertProjectCmsMenu:async n=>{await r.upsertProjectCmsMenu(n),await r.getCmsMenuAdmin()},deleteProjectCmsMenu:async n=>{await r.deleteProjectCmsMenu(n),await r.getCmsMenuAdmin()},upsertBunchCmsMenuItem:async n=>{const _=n.map(v=>r.upsertCmsMenuItem(v));await Promise.all(_),await r.getCmsMenuAdmin()},upsertProjectCmsMenuItemPrivilegeCommand:async n=>{await r.upsertProjectCmsMenuItemPrivilegeCommand(n),await r.getCmsMenuAdmin()},deleteProjectCmsMenuItem:async n=>{await r.deleteProjectCmsMenuItem(n),await r.getCmsMenuAdmin()},deleteProjectCmsMenuItemPrivilegeCommand:async n=>{await r.deleteProjectCmsMenuItemPrivilegeCommand(n),await r.getCmsMenuAdmin()}}},le=t=>t.CmsMenuAdminReducer.current_menu_id?t.CmsMenuAdminReducer.cms.find(r=>r.id==t.CmsMenuAdminReducer.current_menu_id):null,ce=t=>r=>t?r.CmsMenuAdminReducer.cms.find(n=>n.id==r.CmsMenuAdminReducer.current_menu_id).menu_items.find(n=>n.id==t):null,me=t=>r=>t?r.CmsMenuAdminReducer.cms.find(n=>n.id==t):null;function U(){const t=K(),{cmsMenuAdminReducer:r}=$(o=>({cmsMenuAdminReducer:o.CmsMenuAdminReducer})),[n,_]=x.useState(),[v,I]=x.useState(),f=$(le),d=$(ce(n)),M=$(me(v)),a=x.useCallback(S(t).getCmsMenuAdmin,[t]),i=x.useCallback(S(t).deleteProjectCmsMenu,[t]),u=x.useCallback(S(t).getProjectCmsMenuElement,[t]),l=x.useCallback(S(t).setCurrentMenuId,[t]),b=x.useCallback(S(t).upsertCmsMenuItem,[t]),k=x.useCallback(S(t).upsertBunchCmsMenuItem,[t]),T=x.useCallback(S(t).deleteProjectCmsMenuItem,[t]),A=x.useCallback(S(t).upsertProjectCmsMenuItemPrivilegeCommand,[t]),h=x.useCallback(S(t).deleteProjectCmsMenuItemPrivilegeCommand,[t]),w=x.useCallback(S(t).upsertProjectCmsMenu,[t]),B=x.useCallback(S(t).clean,[t]);return{selectors:{cmsMenuAdminReducer:r,getCurrentCmsMenuReducer:f,getCmsMenuItemReducer:d,getCmsMenuReducer:M},actions:{getCmsMenuAdmin:a,getProjectCmsMenuElement:u,setCurrentMenuId:l,upsertCmsMenuItem:b,upsertBunchCmsMenuItem:k,upsertProjectCmsMenu:w,deleteProjectCmsMenu:i,deleteProjectCmsMenuItem:T,upsertProjectCmsMenuItemPrivilegeCommand:A,deleteProjectCmsMenuItemPrivilegeCommand:h,clean:B},state:{cmsMenuId:v,cmsMenuItemId:n},hooks:{setCmsMenuId:I,setCmsMenuItemId:_},functions:{}}}var q={},de=J,Ce=ee;Object.defineProperty(q,"__esModule",{value:!0});var Y=q.default=void 0,pe=Ce(x),Me=de(X()),ge=(0,Me.default)(pe.createElement("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 00-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"}),"Edit");Y=q.default=ge;function fe({cmsMenuItem:t,setCmsMenuItem:r}){const n=s.useMemo(()=>te.byName("mapps-component-translate-component").component,[]),_=s.useMemo(p().Layouts.Groups.V1),v=s.useMemo(p().FormComponents.TextBox),I=s.useMemo(p().FormComponents.Checkbox),{getPlaceholder:f,getLabel:d,translate:M}=F(),[a,i]=s.useState({...t});s.useEffect(()=>{r(a)},[a]);function u(l){a.translation_id||(a.translation_id=E()),l.id||(l.id=a.translation_id),i({...a,translation:l})}return j(c,{container:!0,children:[e(c,{item:!0,xs:6,style:{display:"flex"},children:j(_,{title:"Menu Item Details",children:[e(v,{onChange:l=>{i({...a,url:l.target.value})},placeholder:M(f,"Url"),label:M(d,"Url"),value:a.url,field:"url",validation:[]}),e(v,{onChange:l=>{i({...a,icon:l.target.value})},placeholder:M(f,"Icon"),label:M(d,"Icon"),value:a.icon,field:"icon",validation:[]}),e(v,{onChange:l=>{i({...a,plugin_name:l.target.value})},placeholder:M(f,"Plugin Name"),label:M(d,"Plugin Name"),value:a.plugin_name,field:"plugin_name",validation:[]}),e(I,{label:M(d,"Active"),value:a.is_active,onChange:l=>{i({...a,is_active:l.target.checked})}}),e(I,{label:M(d,"Is Expanded (For Accordion Menu Variant)"),value:a.is_expanded,onChange:l=>{i({...a,is_expanded:l.target.checked})}})]})}),e(c,{item:!0,xs:6,style:{display:"flex"},children:e(_,{title:"Menu Item Translation",children:e(n,{translation:a.translation||{},setTranslate:u,i:!0})})})]})}function he({cmsMenuItemId:t,cmsMenuParentId:r}){const n=s.useMemo(p().ButtonLoader),_=V(),{translate:v,getLabel:I}=F(),[f,d]=s.useState(!0),[M,a]=s.useState({}),{selectors:{getCmsMenuItemReducer:i,getCurrentCmsMenuReducer:u},actions:{upsertCmsMenuItem:l},hooks:{setCmsMenuItemId:b}}=U();s.useEffect(()=>{t?b(t):(a({id:E(),sort_order:0}),d(!1))},[]),s.useEffect(()=>{i&&(a(i),d(!1))},[i]);async function k(){u&&(await l({...M,cms_menu_id:u.id,cms_menu_item_parent_id:r}),_.actions.closeDrawer())}return!f&&j(c,{container:!0,children:[e(fe,{cmsMenuItem:{...M},setCmsMenuItem:a}),e(c,{style:{marginLeft:"1rem",marginBottom:"1rem"},children:e(n,{color:"primary",onClick:k,value:v(I,"Save"),variant:"outlined"})})]})}const ve=["!","|","&","="];function _e({cmsMenuItemId:t}){const r=s.useMemo(p().Layouts.Groups.V1),n=s.useMemo(p().BodyLoader),_=s.useMemo(p().ButtonLoader),v=s.useMemo(p().FormComponents.DropDownList),I=s.useMemo(p().FormComponents.TextBox),f=s.useMemo(p().FormComponents.TagComponent);V();const{translate:d,getLabel:M}=F(),[a,i]=s.useState(!0),[u,l]=s.useState({}),{selectors:{privsSelector:b}}=ne(),{selectors:{getCmsMenuItemReducer:k,getCurrentCmsMenuReducer:T},actions:{upsertCmsMenuItem:A,upsertProjectCmsMenuItemPrivilegeCommand:h,deleteProjectCmsMenuItemPrivilegeCommand:w},hooks:{setCmsMenuItemId:B}}=U();s.useEffect(()=>{t&&B(t)},[]),s.useEffect(()=>{k&&(l(k),i(!1))},[k]);function o(){const m=[],D=b.filter(y=>!m.includes(y.id));return[{id:"",value:""},...D].map(y=>({id:y.id,value:y.privilege||y.value}))}function C(m){const D=m.currentTarget.dataset.key;i(!0),w({id:D}).then(y=>{i(!1)})}function g(m){i(!0),h({id:E(),status:1,privilege_id:m.target.value,cms_menu_item_id:t}).then(D=>{i(!1)})}function L(m,D){if(m.split(" ").filter(y=>!y.startsWith("#")).length+1!=m.split(" ").filter(y=>y.startsWith("#")).length)return!1;{const y=m.split(" ").filter(N=>N.startsWith("#$")).map(N=>N.replace(/#/g,"").replace("$",""));return y.filter(N=>D.map(Z=>Z.privileges.privilege_details.name.trim()).includes(N)).length==y.length}}function P(){i(!0),A(u).then(m=>{i(!1)})}try{return u&&!a?j(c,{container:!0,style:{display:"flex"},children:[e(r,{title:"Menu Item Details",children:e(I,{disabled:!0,label:d(M,"Url"),value:u.url,field:"value",validation:[]})}),j(r,{title:"Allowed Privileges",children:[e(v,{label:"Privileges",valueOptions:o(),value:"",onChange:g,field:"type",validation:[]}),u.menu_item_privileges.map((m,D)=>e(se,{"data-key":m.id,onClick:C,label:m.privileges.privilege_details.name.trim()},m.id))]}),j(r,{title:"Function",style:{display:"flex",width:"100%"},children:[e(c,{xs:12,children:e(f,{notUniq:!0,disabled:!0,tags:u.func?u.func.split(" ").map(m=>({id:E(),value:E(),label:m})):[],noLabel:!0,onChange:m=>{const D=m.map(y=>y.label).join(" ");l({...u,func:D})},suggestions:[...ve.map(m=>({value:m,label:m,type:"OPERATOR"})),,...u.menu_item_privileges.map(m=>({id:E(),value:E(),label:`#$${m.privileges.privilege_details.name.trim()}#`,type:"PRIV"}))]})}),e(c,{xs:12,style:{marginLeft:"1rem",marginBottom:"1rem",marginTop:"1rem"},children:u.func?e(c,{style:{color:L(u.func,u.menu_item_privileges)?"green":"red"},children:u.func}):e(O,{})}),e(c,{xs:12,style:{marginLeft:"1rem",marginBottom:"1rem",marginTop:"1rem"},children:e(_,{color:"primary",onClick:P,value:d(M,"Save Func"),variant:"outlined"})})]})]}):e(c,{style:{height:"400px",display:"flex",width:"100%"},children:e(n,{text:" ",size:"25px"})})}catch(m){return console.log(m),e(O,{})}}function ye({node:t}){const r=s.useMemo(p().ButtonLoader);return t?e(O,{children:e(r,{className:t.isActive==!0?"selected":"",variant:"clean",size:"small",value:e(c,{style:{display:"flex",flexDirection:"column"},children:e(c,{children:String(t.translation?t.translation.name:t.url).toUpperCase()})}),startIcon:t.icon?G[t.icon]?G[t.icon].render():e("img",{style:{maxWidth:20,maxHeight:20,width:20},src:window.env.BLOB_URL+"/blob/"+t.icon},t.id):e(c,{style:{maxWidth:20,maxHeight:20,width:20}})},t.id)}):e(O,{})}function Ie(){const t=s.useMemo(p().ConfirmationDialog),[r,n]=s.useState([{title:"_ROOT",category:"_ROOT",children:[{title:"index.js",category:" "}]}]);s.useState(""),s.useState(!0),s.useMemo(p().Layouts.Table.V2);const _=s.useMemo(p().Layouts.Sections.V1),v=s.useMemo(p().Layouts.Groups.V1),I=s.useMemo(p().ButtonLoader),{actions:f}=V(),d=Q(),{translate:M,getLabel:a}=F(),{selectors:{getCurrentCmsMenuReducer:i},actions:{getCmsMenuAdmin:u,upsertCmsMenuItem:l,upsertBunchCmsMenuItem:b,deleteProjectCmsMenuItem:k}}=U();s.useEffect(()=>{window.__isReactDndBackendSetUp&&(window.__isReactDndBackendSetUp=!1)},[]),s.useEffect(()=>{i&&T()},[i]);function T(){const o=i.menu_items.sort((g,L)=>g.sort_order>L.sort_order?1:-1).map(g=>({...g,treeIndex:g.sort_order,expanded:!0})),C=A([...o.map(g=>({...g}))]);n([...C.map(g=>({...g}))])}function A(o){const C={};let g;const L=[];let P;for(P=0;P<o.length;P+=1)C[o[P].id]=P,o[P].children=[];for(P=0;P<o.length;P+=1)try{g=o[P],g.cms_menu_item_parent_id!==null?o[C[g.cms_menu_item_parent_id]].children.push(g):L.push(g)}catch{}return L}function h(o,C,g){f.openDrawer(!0,e(c,{style:{width:"50vw",display:"flex"},children:e(he,{cmsMenuParentId:C,cmsMenuItemId:g})}),"right")}function w(o,C){f.openDrawer(!0,e(c,{style:{width:"50vw",display:"flex"},children:e(_e,{cmsMenuItemId:C})}),"right")}function B(o,C){d.actions.openDialog(!0,e(t,{title:"Delete Menu Item",description:"Do you want to delete asdasdasd menu item?",onConfirm:async()=>{d.actions.closeDialog(),await k({id:C})}}))}return i?j(_,{title:i.token,children:[e(c,{children:e(I,{color:"primary",onClick:h,value:M(a,"Create"),startIcon:e(W,{}),variant:"outlined"})}),e(v,{title:"Category Tree",children:e(c,{style:{display:"block",width:"100%",height:"100%"},children:e(ae,{rowHeight:55,style:{height:"800px"},treeData:r,onChange:o=>{n([...o])},canDrag:o=>!0,onMoveNode:async o=>{let C=[];return o.nextParentNode?C=o.nextParentNode.children.map((L,P)=>({...L,sort_order:P,title:void 0,children:[],cms_menu_item_parent_id:o.nextParentNode.id})):C=o.treeData.map((g,L)=>({...g,sort_order:L,children:[],title:void 0,cms_menu_item_parent_id:null})),await b(C),o},generateNodeProps:o=>(o.node.title=e(c,{style:{paddingLeft:20},children:e(ye,{node:{...o.node}})}),o.buttons=[],o.buttons.push(e(z,{size:"small",onClick:C=>h(C,o.node.id),children:e(W,{})})),o.buttons.push(e(z,{size:"small",onClick:C=>h(C,o.node.cms_menu_item_parent_id,o.node.id),children:e(Y,{})})),o.buttons.push(e(z,{size:"small",onClick:C=>B(C,o.node.id),children:e(oe,{})})),o.buttons.push(e(z,{size:"small",onClick:C=>w(C,o.node.id),children:e(ie,{})})),o),onlyExpandSearchedNodes:!0})})})]}):e(O,{})}function Pe({cmsMenuId:t}){const r=s.useMemo(p().Layouts.Groups.V1),n=s.useMemo(p().FormComponents.TextBox),_=s.useMemo(p().FormComponents.Checkbox),v=s.useMemo(p().ButtonLoader),I=V(),{translate:f,getLabel:d,getPlaceholder:M}=F(),[a,i]=s.useState(!0),[u,l]=s.useState({}),{selectors:{getCmsMenuReducer:b},actions:{upsertProjectCmsMenu:k},hooks:{setCmsMenuId:T}}=U();s.useEffect(()=>{t?T(t):(l({id:E(),sort_order:0}),i(!1))},[]),s.useEffect(()=>{b&&(l(b),i(!1))},[b]);async function A(){await k({...u}),I.actions.closeDrawer()}return!a&&j(c,{container:!0,children:[e(c,{item:!0,xs:12,style:{display:"flex"},children:j(r,{title:"Menu Details",children:[e(n,{onChange:h=>{l({...u,token:h.target.value})},placeholder:f(M,"Menu token"),label:f(d,"Menu token"),value:u.token,field:"menu-token",validation:[]}),e(_,{label:f(d,"Load on init"),value:u.load_on_init,onChange:h=>{l({...u,load_on_init:h.target.checked})}}),e(_,{label:f(d,"Active"),value:u.is_active,onChange:h=>{l({...u,is_active:h.target.checked})}})]})}),e(c,{style:{marginLeft:"1rem",marginBottom:"1rem"},children:e(v,{color:"primary",onClick:A,value:f(d,"Save"),variant:"outlined"})})]})}function Ae(){const t=s.useMemo(p().ConfirmationDialog),[r,n]=s.useState(!0),_=s.useMemo(p().Layouts.Table.V2),v=s.useMemo(p().Layouts.Containers.V1),I=s.useMemo(p().ButtonLoader),{actions:f}=V(),d=Q(),{translate:M,getLabel:a}=F(),{selectors:{cmsMenuAdminReducer:i},actions:{getCmsMenuAdmin:u,setCurrentMenuId:l,deleteProjectCmsMenu:b,clean:k}}=U();s.useEffect(()=>(n(!0),Promise.all([u()]).then(h=>{n(!1)}),k),[]);function T(h,w){f.openDrawer(!0,e(c,{style:{width:"50vw",display:"flex"},children:e(Pe,{cmsMenuId:w&&w.id})}),"right")}function A(h,w){d.actions.openDialog(!0,e(t,{title:"Delete CMS Menu",description:`Do you want to delete ${w.token} menu?`,onConfirm:async()=>{d.actions.closeDialog(),n(!0),await b(w),n(!1)}}))}return e(c,{container:!0,style:{justifyContent:"center"},children:e(v,{title:"CMS Menus",icon:e(re,{}),xs:12,sm:12,children:j(c,{container:!0,style:{justifyContent:"center"},children:[e(c,{item:!0,xs:6,children:e(_,{freeActions:[e(I,{size:"small",value:M(a,"Create"),variant:"outlined",onClick:T,startIcon:e(W,{})},1)],onRowSelectionChange:h=>{const w=Object.keys(h).map(B=>B);l(w[0])},isLoading:r,title:"Manage CMS Menus",actions:[h=>({icon:G.Edit,label:"Edit",onClick:T}),h=>({icon:G.Delete,label:"Delete",onClick:A})],pageSize:20,...ue({}),data:i.cms||[]})}),e(c,{item:!0,container:!0,xs:6,children:e(Ie,{})})]})})})}export{Ae as default};
